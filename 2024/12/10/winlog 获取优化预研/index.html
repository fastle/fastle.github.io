<!DOCTYPE html>
<html>
  <!-- meta/link... -->
  



<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '');
</script>


  <title>事件查看优化预研 | Fastle的小屋</title>

  <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1911880_c1nvbyezg17.css">
  <link href="https://cdn.jsdelivr.net/gh/inkss/fontawesome@5.15.3/css/all.min.css" rel="stylesheet">
  <link href="/js/swiper/swiper@5.4.1.min.css" rel="stylesheet">
  
  
    <script>
        var themeModelId = '';
        if (themeModelId) {
            localStorage.setItem('modelId', themeModelId);
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/gh/yuang01/live2d-widget@latest/autoload.js"></script>
    <script>
        var live2dOpen = eval('true') || false;
        if (!live2dOpen) {
            localStorage.setItem('waifu-display', 1609323474481);
        }
    </script>
  
  
  
<link rel="stylesheet" href="/css/animate.min.css">

  
<link rel="stylesheet" href="/css/style.css">

  
  
    
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/js/shareJs/share.min.css">

  
  <style>
        @media (max-width: 992px) {
            #waifu {
                display: none;
            }
        }
    </style>
    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

    

    <!-- import link -->
    
        
            
        
            
        
    
    <!-- import script -->
    
        
            
        
            
        
    

<meta name="generator" content="Hexo 7.3.0"></head>

  
  <!-- 依赖于jquery和vue -->
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

  

  
    
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js"></script>

  
  
  <body>
    <!-- 预加载动画 -->
    <!-- 页面预加载动画 -->

<div id='loader'>
  <link rel="stylesheet" href="/js/loaded/index.css" >
  <div class="loading-left-bg"></div>
  <div class="loading-right-bg"></div>
  <div class="spinner-box">
    <div class="configure-border-1">
      <div class="configure-core"></div>
    </div>
    <div class="configure-border-2">
      <div class="configure-core"></div>
    </div>
    <div class="loading-word">loading...</div>
  </div>
</div>

<script>
  var endLoading = function () {
    document.body.style.overflow = 'auto';
    document.getElementById('loader').classList.add("loading");
  }
  window.addEventListener('DOMContentLoaded',endLoading);
  
</script>

    
    <!-- 判断是否为暗黑风格 -->
    <!-- 判断是否为黑夜模式 -->
<script>
  let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');

  if (isDark) {
    $(document.body).addClass('darkModel');
  }
</script>

    <!-- 需要在上面加载的js -->
    <script>
  function loadScript(src, cb) {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }

  //https://github.com/filamentgroup/loadCSS
  var loadCSS = function (href, before, media, attributes) {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  };

</script> 

<!-- 轮播图所需要的js -->
<script src="/js/swiper/swiper.min.js"></script>
<script src="/js/swiper/vue-awesome-swiper.js"></script>
<script src="/js/swiper/swiper.animate1.0.3.min.js"></script>

<script type="text/javascript">
  Vue.use(window.VueAwesomeSwiper)
</script>


  <script src="/js/vue-typed-js/index.js"></script>


<!-- 首页的公告滚动插件的js需要重新加载 -->
<script src="/js/vue-seamless-scroll/index.js"></script>

<!-- 打字机效果js -->
<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>


    <div id="safearea">
      <main class="main" id="pjax-container">
        <!-- 头部导航 -->
        
<header class="header   " 
  id="navHeader"
  style="position: fixed;
  left: 0; top: 0; z-index: 10;width: 100%;"
>
  <div class="header-content">
    <div class="bars">
      <div id="appDrawer" class="sidebar-image">
  <div class="drawer-box-icon">
    <i class="fas fa-bars" aria-hidden="true" @click="showDialogDrawer"></i>
  </div>
  
  <transition name="fade">
    <div class="drawer-box_mask" v-cloak style="display: none;" v-show="visible" @click.self="cancelDialogDrawer">
    </div>
  </transition>
  <div class="drawer-box" :class="{'active': visible}">
    <div class="drawer-box-head bg-color">
      <img class="drawer-box-head_logo lazyload placeholder" src="/medias/logo.png" class="lazyload placeholder" data-srcset="/medias/logo.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo">
      <h3 class="drawer-box-head_title">Fastle的小屋</h3>
      <h5 class="drawer-box-head_desc"></h5>
    </div>
    
    <div class="drawer-box-content">
      <ul class="drawer-box-content_menu">
        
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/" class="drawer-menu-item-link">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">Home</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/archives" class="drawer-menu-item-link">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">Archives</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/tags" class="drawer-menu-item-link">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">Tags</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/categories" class="drawer-menu-item-link">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">Categories</span>
                </a>
              
            </li>
          
            <li class="drawer-box-content_item" style="position: relative;">
              
                <a href="/about" class="drawer-menu-item-link">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">About</span>
                </a>
              
            </li>
          
        
        
          <li class="drawer-box-content_item">
            <a target="_blank" rel="noopener" href="https://github.com/fastle">
              <i class="fas fa-github" aria-hidden="true"></i>
              <span>Github</span>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>

<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appDrawer',
    data: {
      visible: false,
      top: 0,
      openArr: [],
    },
    computed: {
    },
    mounted() {
    },
    methods: {
      isOpen(index) {
        if (this.openArr.includes(index)) {
          return true;
        } else {
          return false;
        }
      },
      openOrCloseMenu(curIndex) {
        const index = this.openArr.indexOf(curIndex);
        if (index !== -1) {
          this.openArr.splice(index, 1);
        } else {
          this.openArr.push(curIndex);
        }
      },
      showDialogDrawer() {
        this.visible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'width: 100%; height: 100%;overflow: hidden;';
      },
      cancelDialogDrawer() {
        this.visible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      }
    },
    created() {}
  })
</script>

    </div>
    <div class="blog-title" id="author-avatar">
      
        <div class="avatar">
          <img src="/medias/logo.png" class="lazyload placeholder" data-srcset="/medias/logo.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="logo">
        </div>
      
      <a href="/" class="logo">Fastle的小屋</a>
    </div>
    <nav class="navbar">
      <ul class="menu">
        
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/" class="menu-item-link" title="Home">
                  
                    <i class="fas fa-home" aria-hidden="true"></i>
                  
                  <span class="name">Home</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/archives" class="menu-item-link" title="Archives">
                  
                    <i class="fas fa-archive" aria-hidden="true"></i>
                  
                  <span class="name">Archives</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/tags" class="menu-item-link" title="Tags">
                  
                    <i class="fas fa-tags" aria-hidden="true"></i>
                  
                  <span class="name">Tags</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/categories" class="menu-item-link" title="Categories">
                  
                    <i class="fas fa-bookmark" aria-hidden="true"></i>
                  
                  <span class="name">Categories</span>
                </a>
              
            </li>
          
            <li class="menu-item" style="position: relative;">
              
                <a href="/about" class="menu-item-link" title="About">
                  
                    <i class="fas fa-user" aria-hidden="true"></i>
                  
                  <span class="name">About</span>
                </a>
              
            </li>
          
        
      </ul>
      
      
        <div id="appSearch">
  <div class="search"  @click="showDialog()"><i class="fas fa-search" aria-hidden="true"></i></div>
  <transition name="fade">
    <div class="message-box_wrapper" style="display: none;" v-cloak v-show="dialogVisible" @click.self="cancelDialogVisible()">
      <div class="message-box animated bounceInDown">
        <h2>
          <span>
            <i class="fas fa-search" aria-hidden="true"></i>
            <span class="title">Search</span>
          </span>
          <i class="fas fa-times close" pointer style="float:right;" aria-hidden="true" @click.self="cancelDialogVisible()"></i>
        </h2>
        <form class="site-search-form">
          <input type="text"
            placeholder="Please enter keywords"
            id="local-search-input" 
            @click="getSearchFile()"
            class="st-search-input"
            v-model="searchInput"
          />
        </form>
        <div class="result-wrapper">
          <div id="local-search-result" class="local-search-result-cls"></div>
        </div>
      </div>
    </div>
  </transition>
</div>
<script src="/js/local_search.js"></script>
<script>
  var body = document.body || document.documentElement || window;
  var vm = new Vue({
    el: '#appSearch',
    data: {
      dialogVisible: false,
      searchInput: '',
      top: 0,
    },
    computed: {
    },
    mounted() {
      window.addEventListener('pjax:complete', () => {
        this.cancelDialogVisible();
      })
    },
    methods: {
      showDialog() {
        this.dialogVisible = true;
        // 防止页面滚动，只能让弹框滚动
        this.top = $(document).scrollTop()
        body.style.cssText = 'overflow: hidden;';
      },
      getSearchFile() {
        if (!this.searchInput) {
          getSearchFile("/search.xml");
        }
      },
      cancelDialogVisible() {
        this.dialogVisible = false;
        body.removeAttribute('style');
        $(document).scrollTop(this.top)
      },
    },
    created() {}
  })
</script>
<!-- 解决刷新页面闪烁问题，可以在元素上添加display: none, 或者用vue.extend方法，详情：https://blog.csdn.net/qq_31393401/article/details/81017912 -->
<!-- 下面是搜索基本写法 -->
<!-- <script type="text/javascript" id="local.search.active">
  var inputArea = document.querySelector("#local-search-input");
  inputArea.onclick   = function(){ getSearchFile(); this.onclick = null }
  inputArea.onkeydown = function(){ if(event.keyCode == 13) return false }
</script> -->

      

    </nav>
  </div>
  
    <a target="_blank" rel="noopener" href="https://github.com/fastle" class="github-corner color-primary" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  
  
    <div id="he-plugin-simple"></div>
    <script>
      WIDGET = {
        CONFIG: {
          "modules": "012",
          "background": 5,
          "tmpColor": "4A4A4A",
          "tmpSize": 16,
          "cityColor": "4A4A4A",
          "citySize": 16,
          "aqiSize": 16,
          "weatherIconSize": 24,
          "alertIconSize": 18,
          "padding": "10px 10px 10px 10px",
          "shadow": "1",
          "language": "auto",
          "borderRadius": 5,
          "fixed": "false",
          "vertical": "middle",
          "horizontal": "center",
          "key": "2784dd3fcb1e4f0f9a9b579bf69641f2"
        }
      }
    </script>
    <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script> 
    
</header>
        <!-- 内容区域 -->
        
 <!-- prismjs 代码高亮 -->
 


<div class="bg-dark-floor" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -1;"></div>


  <!-- 文章详情页顶部图片和标题 -->




<div class="post-detail-header" id="thumbnail_canvas" style="background-repeat: no-repeat; background-size: cover; 
  background-position: center center;position: relative;background-image:url('/medias/8.jpg')">
  <div class="post-detail-header-mask"></div>
  <canvas id="header_canvas"style="position:absolute;bottom:0;pointer-events:none;"></canvas>
  
  <div class="post-detail-header_info-box">
    <div class="title-box">
      <span class="title">
        事件查看优化预研
      </span>
    </div>
    
    
      
        <span class="post-detail-header_date">
          <i class="fas fa-calendar"></i> Published in：2024-12-10 |
        </span>
      

      

      
    
  </div>
  
  
    <script src="/js/bubble/bubble.js"></script>
  
</div>





<div class="row justify-position" 
  style="padding-top: 0px;">
  <div class="main-content">
    <article class="post post-detail">
      <div class="post-content">
        <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>当前规则团队新增的规则需要手动修改从 Windows 获取的事件， 非常不方便。 因此需要进行自动化。</p>
<p>从以下三个方面入手。</p>
<h2 id="自动化动态调整日志的订阅"><a href="#自动化动态调整日志的订阅" class="headerlink" title="自动化动态调整日志的订阅"></a>自动化动态调整日志的订阅</h2><h2 id="自动化修改事件的过滤规则"><a href="#自动化修改事件的过滤规则" class="headerlink" title="自动化修改事件的过滤规则"></a>自动化修改事件的过滤规则</h2><h2 id="自动化修改系统相关配置开关和设定"><a href="#自动化修改系统相关配置开关和设定" class="headerlink" title="自动化修改系统相关配置开关和设定"></a>自动化修改系统相关配置开关和设定</h2><ul>
<li>该部分实现后默认关闭， 设定为只有管理员从 UI 下发才能修改。</li>
</ul>
<h1 id="参考-FD"><a href="#参考-FD" class="headerlink" title="参考 FD"></a>参考 FD</h1><ul>
<li>代京 <a href="FR33088-FR33089-FR33084-windows&linux%E6%95%B0%E6%8D%AE%E6%B5%81&%E7%94%A8%E6%88%B7%E6%80%81%E4%BA%8B%E4%BB%B6%E8%BF%87%E6%BB%A4%E6%9C%BA%E5%88%B6-FD.docx">https://rd.hillstonenet.com/doc/detail/unique-161393</a></li>
</ul>
<h1 id="定位"><a href="#定位" class="headerlink" title="定位"></a>定位</h1><p>edr_trace 溯源</p>
<p>LRU filebeat&#x2F;input&#x2F;hillstone&#x2F;lruCache</p>
<p>winlog 日志按照条件过滤 &#x2F;beats3&#x2F;uhs-log&#x2F;ues&#x2F;uhs-data-main.yml</p>
<p>bugID 436881 数据过滤 增加EDR winlog 事件的自动过滤配置。  r18546 r18629</p>
<p>beats3&#x2F;uhs-log&#x2F;ues&#x2F;uhs-data-input-windows.yml<br>beats3&#x2F;libbeat.processors&#x2F;enrich_process&#x2F;process_fields.go</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 文件变动监听</li>
<li><input checked="" disabled="" type="checkbox"> 解密解码</li>
<li><input checked="" disabled="" type="checkbox"> winlog 日志采集需求统计</li>
<li><input checked="" disabled="" type="checkbox"> winlog 配置文件写入</li>
<li><input checked="" disabled="" type="checkbox"> 日志采集设置与采集开关</li>
<li><input checked="" disabled="" type="checkbox"> 管道新增模块</li>
<li><input checked="" disabled="" type="checkbox"> 单测编写</li>
<li><input checked="" disabled="" type="checkbox"> 常见EventID 对应Channel 映射（规则已存在）。</li>
<li><input disabled="" type="checkbox"> 常见EventID 对应Channel 映射（规则未存在）。</li>
</ul>
<h1 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h1><ol>
<li><p>cal.go 271-282 怀疑有 ticker 泄露。</p>
</li>
<li><p>有的日志后加 enrich  有的日志没有， 如何统一。（如何识别要进行额外的操作）</p>
</li>
<li><p>对应规则的注意事项。（什么样的规则用 winlog。规则解码出来后如何找到对应的日志相关信息。）</p>
</li>
<li><p>加在哪里是合理可行的。（是否云铠智铠共用）</p>
</li>
<li><p>rules to 其它日志采集是否有类似实现。</p>
</li>
</ol>
<h1 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h1><p>filebeat&#x2F;input&#x2F;hillstone&#x2F;start_windows.go 具有 过滤字样  164 但是看起来这块是云铠的</p>
<p>decode_xml_wineventlog 没用</p>
<p>gowin32.OpenWTSServer函数主要用于打开一个 Windows 终端服务（Terminal Services，WTS）服务器的连接。这个功能在管理远程桌面会话和服务器相关操作中非常有用。</p>
<p>框架实现上已经实现了热重载， 理论上只需要更新 input 文件即可。</p>
<h2 id="通过查看"><a href="#通过查看" class="headerlink" title="通过查看"></a>通过查看</h2><h2 id="ioa-yml"><a href="#ioa-yml" class="headerlink" title="ioa.yml"></a>ioa.yml</h2><p>Line 115739: security</p>
<h2 id="uhs-data-input-windows-yml"><a href="#uhs-data-input-windows-yml" class="headerlink" title="uhs-data-input-windows.yml"></a>uhs-data-input-windows.yml</h2><ul>
<li>event_id 中 负号前缀 表示 不包含。</li>
<li>event_id 信息不能超过 22 个（最好不要超过21个）</li>
</ul>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="文件监控-fsnotify"><a href="#文件监控-fsnotify" class="headerlink" title="文件监控 fsnotify"></a>文件监控 fsnotify</h2><ul>
<li><p>在beats 中可以使用， 用于监控某个文件的变动</p>
</li>
<li><p>once.Do 只执行一次。</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/fsnotify/fsnotify&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;path/filepath&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// update是一个自定义的函数，用于处理文件变动后的逻辑，这里只是示例，可按实际需求修改</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">update</span><span class="params">(filePath <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    log.Printf(<span class="string">&quot;文件 %s 发生变动，执行更新操作...\n&quot;</span>, filePath)</span><br><span class="line">    <span class="comment">// 在这里添加具体的更新逻辑，比如重新读取文件内容等</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">watchFiles</span><span class="params">(file1, file2 <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    watcher, err := fsnotify.NewWatcher()</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> watcher.Close()</span><br><span class="line"></span><br><span class="line">    done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">    <span class="comment">// 用于去重，避免重复处理同一个文件变动事件</span></span><br><span class="line">    processed := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            <span class="keyword">select</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> event, ok := &lt;-watcher.Events:</span><br><span class="line">                <span class="keyword">if</span>!ok &#123;</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 只关注写入、创建、重命名、删除等可能导致文件内容变化的事件</span></span><br><span class="line">                <span class="keyword">if</span> event.Op&amp;(fsnotify.Write|fsnotify.Create|fsnotify.Rename|fsnotify.Remove)!= <span class="number">0</span> &#123;</span><br><span class="line">                    absPath, err := filepath.Abs(event.Name)</span><br><span class="line">                    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">                        log.Printf(<span class="string">&quot;获取文件绝对路径出错: %v\n&quot;</span>, err)</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> _, ok := processed[absPath];!ok &#123;</span><br><span class="line">                        <span class="keyword">if</span> absPath == file1 || absPath == file2 &#123;</span><br><span class="line">                            update(absPath)</span><br><span class="line">                            processed[absPath] = <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> err, ok := &lt;-watcher.Errors:</span><br><span class="line">                <span class="keyword">if</span>!ok &#123;</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">                log.Printf(<span class="string">&quot;监听文件出错: %v\n&quot;</span>, err)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加要监听的文件</span></span><br><span class="line">    err = watcher.Add(file1)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">    err = watcher.Add(file2)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &lt;-done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    file1 := <span class="string">&quot;path/to/file1&quot;</span>  <span class="comment">// 替换为实际的第一个文件路径</span></span><br><span class="line">    file2 := <span class="string">&quot;path/to/file2&quot;</span>  <span class="comment">// 替换为实际的第二个文件路径</span></span><br><span class="line">    watchFiles(file1, file2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在 Go 语言中使用gopkg.in&#x2F;yaml.v3库实现流式读取<br>基本原理<br>流式读取是一种逐块处理数据的方式，而不是一次性将整个文件内容读取到内存中。对于大型的yaml文件，这种方式可以有效减少内存占用。gopkg.in&#x2F;yaml.v3库提供了相应的功能来实现yaml文件的流式读取和解码。<br>示例代码<br>假设yaml文件内容如下（为了演示流式读取，假设文件内容较多，有多个person记录）：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">people:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;John&quot;</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">30</span></span><br><span class="line">    <span class="attr">hobbies:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">reading</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">coding</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;Alice&quot;</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">25</span></span><br><span class="line">    <span class="attr">hobbies:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dancing</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">painting</span></span><br></pre></td></tr></table></figure>
<p>首先，定义一个结构体来接收yaml数据：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name    <span class="type">string</span>   <span class="string">`yaml:&quot;name&quot;`</span></span><br><span class="line">    Age     <span class="type">int</span>      <span class="string">`yaml:&quot;age&quot;`</span></span><br><span class="line">    Hobbies []<span class="type">string</span> <span class="string">`yaml:&quot;hobbies&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下是流式读取yaml文件的代码：</p>
<ul>
<li>ruhe ping jia wang zuo  zuo pai pai zuo ta le da zhou <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;gopkg.in/yaml.v3&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    file, err := os.Open(<span class="string">&quot;example.yaml&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;打开文件出错：&quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> file.Close()</span><br><span class="line">    decoder := yaml.NewDecoder(file)</span><br><span class="line">    <span class="keyword">var</span> people []Person</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> person Person</span><br><span class="line">        err := decoder.Decode(&amp;person)</span><br><span class="line">        <span class="keyword">if</span> err == yaml.EOF &#123;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;解码出错：&quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        people = <span class="built_in">append</span>(people, person)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;读取到的人员信息：&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> _, p := <span class="keyword">range</span> people &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;姓名：%s，年龄：%d，爱好：%v\n&quot;</span>, p.Name, p.Age, p.Hobbies)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在这个示例中：<br>首先打开yaml文件，然后使用yaml.NewDecoder函数创建一个解码器decoder，它会从打开的文件中逐块读取yaml数据。</li>
</ul>
<p>通过一个循环，不断调用decoder.Decode方法来读取并解码每一个person结构体的数据。当遇到文件结束符（yaml.EOF）时，循环结束。<br>如果在解码过程中出现错误（除了文件结束符），则打印错误信息并返回。<br>最后，将读取到的所有person信息打印出来。</p>
<ul>
<li><p>因为加解密， 所以最后不能进行流式输入</p>
</li>
<li></li>
</ul>
<h1 id="winlog"><a href="#winlog" class="headerlink" title="winlog"></a>winlog</h1><ul>
<li>存在事件ID复用</li>
</ul>
<ol>
<li><strong>Event ID 1000在不同场景下的复用</strong><ul>
<li>在Windows应用程序日志（Application Log）中，事件ID 1000通常与应用程序错误有关。当一个应用程序（如Microsoft Word）发生崩溃时，会在应用程序日志中记录一个事件ID为1000的事件。这个事件的详细信息可能包含应用程序崩溃的模块名称、异常代码等内容，用于帮助开发人员定位问题。</li>
<li>然而，在某些系统进程（如Windows系统自带的一些服务）出现内部错误并记录日志时，也可能会使用事件ID 1000。例如，Windows更新服务（wuauserv）在更新过程中遇到某些非预期的错误，导致其内部的一个子模块出错，也可能会在系统日志中记录事件ID为1000的事件。不过，此时事件的详细描述会与应用程序崩溃时有所不同，可能会涉及更新相关的组件名称、更新文件的版本等信息。</li>
</ul>
</li>
<li><strong>Event ID 7000在服务启动中的复用</strong><ul>
<li>在Windows服务相关的日志中，事件ID 7000通常用于表示服务启动相关的事件。当一个用户安装并首次启动一个自定义开发的Windows服务时，会记录事件ID为7000的事件，详细信息可能包括服务名称、服务启动类型（自动、手动等）、启动时的依赖关系等。</li>
<li>但在系统更新或者系统组件重新配置后，某些系统关键服务（如Windows防火墙服务）重新启动时，同样会记录事件ID 7000的事件。这里的事件详细描述可能会涉及服务重启的原因（如因为安全策略更新而重启）、服务重启后的状态与之前状态的对比等信息。</li>
</ul>
</li>
<li><strong>Event ID 4624（用户登录）在不同登录方式下的复用</strong><ul>
<li>在安全日志中，事件ID 4624主要表示用户成功登录。当用户通过本地账户在本地计算机上登录时，会记录事件ID 4624的事件，详细信息可能包括登录的用户名、登录的时间、登录的方式（如交互式登录）等。</li>
<li>当用户通过远程桌面协议（RDP）远程登录到另一台计算机时，同样会记录事件ID 4624的事件。不过，此时事件的详细描述会包含远程登录的源IP地址、远程登录的会话ID等额外信息，以区分本地登录和远程登录这两种不同的登录场景。</li>
</ul>
</li>
</ol>
<h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buildDataset</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="一份奶茶算上配送费30块，喝不起"><a href="#一份奶茶算上配送费30块，喝不起" class="headerlink" title="一份奶茶算上配送费30块，喝不起"></a>一份奶茶算上配送费30块，喝不起</h1><h1 id="winlog-1"><a href="#winlog-1" class="headerlink" title="winlog"></a>winlog</h1><ul>
<li>存在事件id 复用</li>
</ul>
<ol>
<li><strong>Event ID 1000在不同场景下的复用</strong></li>
</ol>
<p>以下是一种基于Kubernetes（k8s）实现多台机器通过资源进行通信，由Controller下发命令，Agent监听并完成任务的架构设计示例，同时尽量考虑避免常见问题：</p>
<h3 id="整体架构概述"><a href="#整体架构概述" class="headerlink" title="整体架构概述"></a>整体架构概述</h3><p>该架构主要包含三个核心组件：Controller（控制端）、Agent（代理端，运行在各个节点机器上）以及共享的资源存储（可以利用Kubernetes自身的资源对象等作为媒介来实现），它们之间通过合理的机制交互协作，以完成命令下发与执行的流程。</p>
<h3 id="一、Controller组件设计"><a href="#一、Controller组件设计" class="headerlink" title="一、Controller组件设计"></a>一、Controller组件设计</h3><ol>
<li><strong>功能职责</strong><ul>
<li>负责生成具体的任务命令，这些命令可以基于业务逻辑进行定制，例如配置变更、服务启动&#x2F;停止指令等。</li>
<li>监控任务的执行状态，需要和Agent保持通信，收集任务执行反馈，便于后续决策（如重试、告警等）。</li>
<li>与Kubernetes API Server进行交互，将任务相关的信息以合适的资源形式存储到集群中，方便Agent获取。</li>
</ul>
</li>
<li><strong>实现要点及避免的问题</strong><ul>
<li><strong>配置管理</strong>：采用配置文件或者环境变量等方式加载自身的配置信息，配置项例如连接Kubernetes API Server的认证信息、默认的任务超时时间等。为避免配置错误导致无法正常连接集群或者不合理的任务超时设定影响执行效果，在启动时进行配置合法性校验，并且提供配置热更新功能（可以通过监听配置变更的ConfigMap等机制实现），以便在运行中修正配置问题。</li>
<li><strong>与API Server交互</strong>：使用Kubernetes官方提供的客户端库（如Go语言的 <code>client-go</code>）来与API Server通信，确保按照API规范操作资源。避免频繁创建过多的连接实例浪费资源，可采用连接池技术复用连接；同时处理好连接异常情况，设置合理的重试策略，防止因网络闪断等原因导致命令无法下发到集群资源存储处。</li>
<li><strong>任务调度与状态管理</strong>：基于任务队列来管理待下发的任务，保证任务的顺序性和并发控制（例如限制同时下发的任务数量，避免集群资源瞬间压力过大）。维护一个任务状态的存储（可以是内存中的数据结构结合持久化存储如数据库等），准确记录任务从创建、下发到执行各个阶段的状态，避免出现任务状态丢失或者不一致的情况，对于长时间处于异常状态的任务要能及时告警。</li>
</ul>
</li>
</ol>
<h3 id="二、Agent组件设计"><a href="#二、Agent组件设计" class="headerlink" title="二、Agent组件设计"></a>二、Agent组件设计</h3><ol>
<li><strong>功能职责</strong><ul>
<li>运行在各个Kubernetes节点机器上，监听特定的资源变化（例如自定义资源或者ConfigMap、Secret等的更新），这些资源变化即代表Controller下发的命令。</li>
<li>解析获取到的命令内容，并按照命令要求在本地节点执行相应的操作，操作可能涉及到调用系统命令、操作容器运行时（如Docker、containerd）等。</li>
<li>将任务执行的结果（成功、失败及详细的错误信息等）反馈给Controller，以便Controller掌握整体执行情况。</li>
</ul>
</li>
<li><strong>实现要点及避免的问题</strong><ul>
<li><strong>监听机制</strong>：利用Kubernetes的Watch机制（通过客户端库监听资源对象的变更事件）来实时获取命令相关资源的更新情况，避免采用轮询方式消耗过多的系统资源和网络带宽。同时，要做好对Watch连接异常的处理，当连接断开时要有自动重连机制，防止遗漏命令更新事件。</li>
<li><strong>命令解析与执行</strong>：对获取到的命令内容进行严格的格式校验，按照预先定义好的命令格式规范进行解析，避免因命令格式错误导致执行出错。在执行命令时，要考虑命令执行的超时处理（可以通过设置系统信号或者定时器等方式实现），防止命令执行时间过长导致节点资源被长时间占用，影响其他服务；另外，执行涉及系统权限的操作时，遵循最小权限原则，避免因权限过大带来安全隐患。</li>
<li><strong>反馈机制</strong>：通过可靠的通信方式（比如向Controller暴露的API接口发送HTTP请求或者使用消息队列等）将任务执行结果反馈回去，要处理好反馈过程中的网络异常情况，采用重试、缓存结果待网络恢复后发送等策略，确保结果能准确传达给Controller，避免出现Controller因未收到反馈而错误判断任务执行情况。</li>
</ul>
</li>
</ol>
<h3 id="三、共享资源存储设计"><a href="#三、共享资源存储设计" class="headerlink" title="三、共享资源存储设计"></a>三、共享资源存储设计</h3><ol>
<li><strong>资源选择与定义</strong><br>可以选择自定义资源（Custom Resources，通过CRD定义）来承载具体的命令内容和相关的任务元数据（如任务ID、优先级等），或者利用ConfigMap（适合简单的配置类命令）、Secret（用于包含敏感信息的命令场景，如包含密码的数据库操作命令等）等已有的Kubernetes资源类型，根据实际业务需求灵活决定。</li>
<li><strong>数据一致性与版本控制</strong><br>不管选择哪种资源形式，要确保资源数据在多副本环境下的一致性，Kubernetes本身对于资源存储有一定的分布式一致性保障机制，但在更新频繁等特殊场景下，可以考虑添加额外的版本控制字段（类似乐观锁机制，通过比对版本号来决定是否更新成功），避免出现数据冲突问题。同时，对于历史命令记录等可以根据业务需要进行合理的保留和清理，防止存储资源无限增长。</li>
</ol>
<h3 id="四、通信安全与可靠性保障"><a href="#四、通信安全与可靠性保障" class="headerlink" title="四、通信安全与可靠性保障"></a>四、通信安全与可靠性保障</h3><ol>
<li><strong>安全方面</strong><ul>
<li>在Controller与Agent通信以及它们和Kubernetes API Server交互过程中，使用TLS加密传输数据，避免命令等敏感信息在网络传输中被窃取或篡改。</li>
<li>对Controller和Agent进行身份认证，例如基于Kubernetes的RBAC（基于角色的访问控制）机制，确保只有合法授权的组件才能进行相应的操作（Controller有权限下发命令到指定资源，Agent有权限读取和更新对应节点相关的资源等），防止非法访问带来的安全风险。</li>
</ul>
</li>
<li><strong>可靠性方面</strong><ul>
<li>整个架构的各个组件都要具备良好的容错能力，如Controller可以部署多个副本实现高可用，通过负载均衡等方式将请求均匀分发；Agent所在的节点若出现故障（机器宕机、网络故障等），在节点恢复后能够自动重新连接到集群，继续监听任务命令并执行后续操作，确保整体任务执行不受单点故障过多影响。</li>
</ul>
</li>
</ol>
<p>通过上述这样一个较为完善的架构设计，在Kubernetes多台机器环境下，能较好地实现Controller下发命令，Agent监听并执行的流程，同时通过一系列机制避免常见的配置、通信、安全以及执行方面的问题，保障系统的稳定可靠运行。不过在实际落地中，还需要根据具体的业务场景、集群规模等因素进一步优化和调整各部分的细节实现。 </p>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ol>
<li>在 agent 重启之后，是否需要重新获取配置文件。</li>
<li>多 agent 如何设计。（不同客户端需要的并不同， 所以应该分开设计）</li>
</ol>
<p>以下是使用Go语言结合Kubernetes的<code>client-go</code>库，基于上述架构实现的一个简单关键代码示例，包含了Controller和Agent的核心逻辑部分，这里假设使用自定义资源（Custom Resource）来作为命令传递的媒介。</p>
<h3 id="1-定义自定义资源（Custom-Resource-Definition，CRD）"><a href="#1-定义自定义资源（Custom-Resource-Definition，CRD）" class="headerlink" title="1. 定义自定义资源（Custom Resource Definition，CRD）"></a>1. 定义自定义资源（Custom Resource Definition，CRD）</h3><p>首先需要定义自定义资源的结构以及相关的配置，示例代码如下（简化示意，实际应用中可能更复杂）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入必要的库</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    metav1 <span class="string">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span></span><br><span class="line">    <span class="string">&quot;k8s.io/apimachinery/pkg/runtime&quot;</span></span><br><span class="line">    <span class="string">&quot;k8s.io/apimachinery/pkg/runtime/schema&quot;</span></span><br><span class="line">    <span class="string">&quot;k8s.io/client-go/kubernetes/scheme&quot;</span></span><br><span class="line">    <span class="string">&quot;k8s.io/client-go/rest&quot;</span></span><br><span class="line">    <span class="string">&quot;k8s.io/client-go/tools/clientcmd&quot;</span></span><br><span class="line">    <span class="string">&quot;k8s.io/client-go/tools/record&quot;</span></span><br><span class="line">    <span class="string">&quot;sigs.k8s.io/controller-runtime/pkg/client&quot;</span></span><br><span class="line">    <span class="string">&quot;sigs.k8s.io/controller-runtime/pkg/controller&quot;</span></span><br><span class="line">    <span class="string">&quot;sigs.k8s.io/controller-runtime/pkg/handler&quot;</span></span><br><span class="line">    <span class="string">&quot;sigs.k8s.io/controller-runtime/pkg/manager&quot;</span></span><br><span class="line">    <span class="string">&quot;sigs.k8s.io/controller-runtime/pkg/reconcile&quot;</span></span><br><span class="line">    <span class="string">&quot;sigs.k8s.io/controller-runtime/pkg/source&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义命令自定义资源结构</span></span><br><span class="line"><span class="keyword">type</span> Command <span class="keyword">struct</span> &#123;</span><br><span class="line">    metav1.TypeMeta   <span class="string">`json:&quot;,inline&quot;`</span></span><br><span class="line">    metav1.ObjectMeta <span class="string">`json:&quot;metadata,omitempty&quot;`</span></span><br><span class="line">    Spec              CommandSpec   <span class="string">`json:&quot;spec,omitempty&quot;`</span></span><br><span class="line">    Status            CommandStatus <span class="string">`json:&quot;status,omitempty&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令规格，包含具体要执行的命令内容等</span></span><br><span class="line"><span class="keyword">type</span> CommandSpec <span class="keyword">struct</span> &#123;</span><br><span class="line">    Command <span class="type">string</span> <span class="string">`json:&quot;command&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令状态，用于记录命令执行情况</span></span><br><span class="line"><span class="keyword">type</span> CommandStatus <span class="keyword">struct</span> &#123;</span><br><span class="line">    Phase   <span class="type">string</span> <span class="string">`json:&quot;phase&quot;`</span></span><br><span class="line">    Message <span class="type">string</span> <span class="string">`json:&quot;message&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义GroupVersionKind用于注册自定义资源到Kubernetes API</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    CommandKind       = <span class="string">&quot;Command&quot;</span></span><br><span class="line">    CommandAPIVersion = <span class="string">&quot;example.com/v1&quot;</span></span><br><span class="line">    CommandGVK        = schema.GroupVersionKind&#123;</span><br><span class="line">        Group:   <span class="string">&quot;example.com&quot;</span>,</span><br><span class="line">        Version: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">        Kind:    CommandKind,</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册自定义资源到Scheme，方便客户端与API Server交互</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    SchemeBuilder := runtime.NewSchemeBuilder(addKnownTypes)</span><br><span class="line">    err := SchemeBuilder.AddToScheme(scheme.Scheme)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加已知类型到Scheme</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addKnownTypes</span><span class="params">(scheme *runtime.Scheme)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    scheme.AddKnownTypes(schema.GroupVersion&#123;Group: <span class="string">&quot;example.com&quot;</span>, Version: <span class="string">&quot;v1&quot;</span>&#125;,</span><br><span class="line">        &amp;Command&#123;&#125;)</span><br><span class="line">    metav1.AddToGroupVersion(scheme, schema.GroupVersion&#123;Group: <span class="string">&quot;example.com&quot;</span>, Version: <span class="string">&quot;v1&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Controller核心代码"><a href="#2-Controller核心代码" class="headerlink" title="2. Controller核心代码"></a>2. Controller核心代码</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Controller结构体，管理命令的下发和状态监控等</span></span><br><span class="line"><span class="keyword">type</span> CommandController <span class="keyword">struct</span> &#123;</span><br><span class="line">    client.Client</span><br><span class="line">    recorder record.EventRecorder</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现Reconcile接口的Reconcile方法，处理自定义资源的变更逻辑</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *CommandController)</span></span> Reconcile(ctx context.Context, req reconcile.Request) (reconcile.Result, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="comment">// 获取对应的命令资源实例</span></span><br><span class="line">    command := &amp;Command&#123;&#125;</span><br><span class="line">    err := r.Get(ctx, req.NamespacedName, command)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> reconcile.Result&#123;&#125;, client.IgnoreNotFound(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里可以添加具体的命令处理逻辑，例如解析命令并决定后续操作等</span></span><br><span class="line">    <span class="comment">// 简单示例，先打印命令内容</span></span><br><span class="line">    log.Printf(<span class="string">&quot;Received command: %s&quot;</span>, command.Spec.Command)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新命令状态为已处理（实际应用中根据执行结果更新更准确的状态）</span></span><br><span class="line">    command.Status.Phase = <span class="string">&quot;Processed&quot;</span></span><br><span class="line">    command.Status.Message = <span class="string">&quot;Command received and processed&quot;</span></span><br><span class="line">    err = r.Status().Update(ctx, command)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> reconcile.Result&#123;&#125;, err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> reconcile.Result&#123;&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置并启动Controller</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetupController</span><span class="params">(mgr manager.Manager)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="comment">// 创建Controller实例，传入客户端和事件记录器</span></span><br><span class="line">    controller := &amp;CommandController&#123;</span><br><span class="line">        Client:    mgr.GetClient(),</span><br><span class="line">        recorder:  mgr.GetEventRecorderFor(<span class="string">&quot;command-controller&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建Controller并注册资源以及对应的处理逻辑</span></span><br><span class="line">    c, err := controller.NewControllerManagedBy(mgr).</span><br><span class="line">        For(&amp;Command&#123;&#125;).</span><br><span class="line">        Build()</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置资源的事件源，这里是监听Command资源的所有变更</span></span><br><span class="line">    err = c.Watch(&amp;source.Kind&#123;Type: &amp;Command&#123;&#125;&#125;, &amp;handler.EnqueueRequestForObject&#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取Kubernetes配置并启动Manager，进而启动Controller</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 加载Kubernetes配置，可以是本地kubeconfig文件或者集群内配置</span></span><br><span class="line">    config, err := clientcmd.BuildConfigFromFlags(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建Manager实例</span></span><br><span class="line">    mgr, err := manager.New(config, manager.Options&#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册自定义资源到Manager的Scheme</span></span><br><span class="line">    err = addKnownTypes(mgr.GetScheme())</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 启动Controller</span></span><br><span class="line">    err = SetupController(mgr)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 启动Manager，开始监听资源变更并处理</span></span><br><span class="line">    <span class="keyword">if</span> err := mgr.Start(context.Background()); err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>chiseled 是切割的意思。<br>所以，</p>
<h3 id="3-Agent核心代码"><a href="#3-Agent核心代码" class="headerlink" title="3. Agent核心代码"></a>3. Agent核心代码</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Agent结构体，用于监听命令并执行</span></span><br><span class="line"><span class="keyword">type</span> Agent <span class="keyword">struct</span> &#123;</span><br><span class="line">    client.Client</span><br><span class="line">    nodeName <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听命令的方法，利用Watch机制监听自定义资源的更新</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Agent)</span></span> ListenForCommands(ctx context.Context) <span class="type">error</span> &#123;</span><br><span class="line">    <span class="comment">// 创建一个Watch对象，监听Command资源</span></span><br><span class="line">    watcher, err := a.Client.Watch(ctx, &amp;metav1.ListOptions&#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> watcher.Stop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> event := <span class="keyword">range</span> watcher.ResultChan() &#123;</span><br><span class="line">        <span class="keyword">if</span> command, ok := event.Object.(*Command); ok &#123;</span><br><span class="line">            <span class="comment">// 简单判断是否是本节点相关的命令（实际可根据更准确的标识判断）</span></span><br><span class="line">            <span class="keyword">if</span> command.ObjectMeta.Labels[<span class="string">&quot;node&quot;</span>] == a.nodeName &#123;</span><br><span class="line">                <span class="comment">// 执行命令逻辑，这里简单打印</span></span><br><span class="line">                log.Printf(<span class="string">&quot;Agent on node %s executing command: %s&quot;</span>, a.nodeName, command.Spec.Command)</span><br><span class="line">                <span class="comment">// 执行完后可以更新命令状态反馈给Controller（此处省略详细更新代码）</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化Agent并启动监听</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 获取当前节点名称，可以通过环境变量等方式获取更准确的节点标识</span></span><br><span class="line">    nodeName := os.Getenv(<span class="string">&quot;NODE_NAME&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> nodeName == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;NODE_NAME environment variable not set&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 加载Kubernetes配置，同Controller部分类似</span></span><br><span class="line">    config, err := clientcmd.BuildConfigFromFlags(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建Agent实例，传入客户端和节点名称</span></span><br><span class="line">    agent := &amp;Agent&#123;</span><br><span class="line">        Client:    client.New(config, client.Options&#123;&#125;),</span><br><span class="line">        nodeName:  nodeName,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ctx := context.Background()</span><br><span class="line">    <span class="comment">// 启动监听命令的逻辑</span></span><br><span class="line">    err = agent.ListenForCommands(ctx)</span><br><span class="line">    <span class="keyword">if</span> err!= <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意，以上代码只是一个非常简化的示例，实际应用中还需要完善很多细节，比如：</p>
<ul>
<li>对命令执行结果更准确的反馈，包括处理执行失败情况以及详细错误信息上报给Controller。</li>
<li>更好的资源管理，例如连接复用、内存优化等，在Controller和Agent与Kubernetes API Server交互时。</li>
<li>更完善的安全机制，如前面提到的TLS加密、RBAC权限控制等代码层面的具体实现。</li>
<li>处理各种异常情况以及添加合适的日志记录，便于排查问题等。</li>
</ul>
<p>但希望这个代码示例能帮助你初步理解基于上述架构在Kubernetes环境下如何实现命令下发与执行的关键流程。 </p>
<h1 id="当前无法解析的-winlog-规则"><a href="#当前无法解析的-winlog-规则" class="headerlink" title="当前无法解析的 winlog 规则"></a>当前无法解析的 winlog 规则</h1><p>当前一共有94条规则无法解析， 对于每种 ID 只展示一条对应规则</p>
<ul>
<li><p>HybridConnectionMannager Service Running Detected(对应 channel: ?)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">  <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">  <span class="attr">service:</span> <span class="string">servicebus</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">  <span class="attr">selection:</span></span><br><span class="line">    <span class="attr">EventID:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="number">40300</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">40301</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">40302</span></span><br></pre></td></tr></table></figure></li>
<li><p>suspicious AppX Package Digital Signature Detected(对应 channel：System)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">  <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">  <span class="attr">service:</span> <span class="string">appxpackaging</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">  <span class="attr">selection:</span></span><br><span class="line">    <span class="attr">EventID:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="number">157</span></span><br></pre></td></tr></table></figure></li>
<li><p>Suspicious BTTS Transfer Job Download Detected (对应 channel：?)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">bits_client</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">16403</span></span><br></pre></td></tr></table></figure></li>
<li><p>New BTTS Job Created From Temp Folder Detected </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">bits_client</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure></li>
<li><p>WMI FilterToConsumerBinding Deletion Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">wmi</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">11</span></span><br></pre></td></tr></table></figure></li>
<li><p>Suspicious WMI Command Line Event Consumer Registered Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">wmi</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">5861</span></span><br></pre></td></tr></table></figure></li>
<li><p>WMI Persistence Detection</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">wmi</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> </span><br><span class="line">          <span class="bullet">-</span> <span class="number">5859</span></span><br><span class="line">          <span class="bullet">-</span> <span class="number">5861</span></span><br></pre></td></tr></table></figure></li>
<li><p>New Process Created Via WMI Call Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">wmi</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">22</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Environment Variable Creation via WMI Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">wmi</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">12</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Suspicious Creation Via WMI Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">wmi</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">23</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>CodeIntergrity Blocked Image&#x2F;Driver Loaded for Policy Violation Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">codeintegrity</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">3077</span></span><br></pre></td></tr></table></figure></li>
<li><p>Blocked Driver Load With Revoke Certificate Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">codeintegrity</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">3023</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Revoked Kernel Driver Loaded Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">codeintegrity</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> [<span class="number">3021</span>, <span class="number">3022</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Unmet WHQL Requirements for loaded Kernel module CodeIntegrity Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">codeintegrity</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> [<span class="number">3082</span>,<span class="number">3083</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>Revoked Certificate Blocked Image Load in Code Integrity Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">codeintegrity</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">3036</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Revoked Image Loaded in Code Integrity Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">codeintegrity</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> [<span class="number">3032</span>,<span class="number">3035</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Unsigned Image Loaded in Code Integrity Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">codeintegrity</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">3037</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Code Integrity - Unmet Signing level Requirements Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">codeintegrity</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> [<span class="number">3033</span>,<span class="number">3034</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>USB Device Plugged Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">driver_framework</span></span><br><span class="line">    <span class="attr">definition:</span> <span class="string">Requires</span> <span class="string">enabling</span> <span class="string">and</span> <span class="string">collection</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Microsoft-Windows-DriverFrameworks-UserMode/Operrational</span> <span class="string">eventlog</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> [<span class="number">2003</span>,<span class="number">2100</span>,<span class="number">2102</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>GALLIUM Activities Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">dns_server_analytic</span></span><br><span class="line">    <span class="attr">definition:</span> <span class="string">Requirements</span> <span class="string">Microsoft-Windows-DNS-Server/Analytical</span> </span><br><span class="line"><span class="string">detection</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">257</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Ngrok Usage with Remote Desktop Service Detected(s)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">terminalservices</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">21</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>DNS Server Failed toload ServerLeverPluginDLL Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">dns_server</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> [<span class="number">150</span>,<span class="number">770</span>,<span class="number">771</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>DNS Sone Transfer Failure Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">dns_server</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">6004</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>SMB Exploitation Attempt for Potential CVE-2023-23397</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">smbclient</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> [<span class="number">30803</span>,<span class="number">30804</span>,<span class="number">30806</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Suspicious Rejected SMB Guest Logon From IP Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">smbclient</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">31017</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>DNS Query to Ufile.io by DNS Client Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">dns_client</span></span><br><span class="line">    <span class="attr">definition:</span> <span class="string">Requrements</span> <span class="string">Microsoft-Windows-DNS</span> <span class="string">Client</span> <span class="string">Events/Operational</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">3008</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Print Spooler Exploitation CVE-2021-1675 detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">printservice</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">316</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>CVE-2021-1675 Prrint Spooler Explotation Detected </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">printservice</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">808</span></span><br></pre></td></tr></table></figure></li>
<li><p>到这是 41 个不同 ID</p>
</li>
<li><p>Deletion of a Rule from Windows Firewall Exception List Detected </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">firewall_as</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> [<span class="number">2006</span>,<span class="number">2052</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>New FireWall Rule Added In Windows Firewall Exception List for Potential Suspicious Application Detected</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">firewall_as</span></span><br><span class="line"><span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> [<span class="number">2004</span>,<span class="number">2071</span>,<span class="number">2097</span>]</span><br></pre></td></tr></table></figure>



</li>
<li><p>Windows Firewall Configuation Rules Deletion Detected</p>
</li>
<li><p>94 rules, </p>
</li>
<li><p>有两种需要enrich 的情况， 一个是使用Security 和 OpenSSH&#x2F;Operational ,需要增加</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">add_tags:</span></span><br><span class="line">        <span class="string">tags:[&quot;abnormalLogon&quot;]</span></span><br></pre></td></tr></table></figure>

<ul>
<li>另一种是使用Microsoft-Windows-TerminalServices-LocalSessionManager&#x2F;Operational， 需要增加</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">enrich_process:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>DNS Sone Transfer Failure Detected<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logsource:</span></span><br><span class="line">    <span class="attr">product:</span> <span class="string">windows</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">dns_server</span></span><br><span class="line">    <span class="attr">definition:</span> <span class="string">Requirements</span> <span class="string">Microsoft-Windows-DNS-Server/Analytical</span></span><br><span class="line">    <span class="attr">detection:</span></span><br><span class="line">    <span class="attr">selection:</span></span><br><span class="line">        <span class="attr">EventID:</span> <span class="number">6004</span></span><br><span class="line">        <span class="string">DNSQuestionName:42.42.42.42</span></span><br><span class="line">        <span class="attr">DNSQuestionType:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">DNSResponseType:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">DNSResponseName:</span> <span class="number">42.42</span><span class="number">.42</span><span class="number">.42</span></span><br><span class="line">        <span class="attr">DNSResponseIP:</span> <span class="number">42.42</span><span class="number">.42</span><span class="number">.42</span></span><br><span class="line">        <span class="attr">DNSResponseTTL:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></li>
<li></li>
</ul>

      </div>
      <div class="post-tags-categories">
        
        <div class="tags">
          
            <a href="/tags/FR/" class="">
              FR
            </a>
          
        </div>
        
      </div>
      
        <div class="copyright">
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>author:  </strong>bqZhang</a>
    </li>
    <li class="post-copyright-link">
    <strong>link:  </strong>
    <a href="/2024/12/10/winlog 获取优化预研/" target="_blank" title="事件查看优化预研">http://example.com/2024/12/10/winlog 获取优化预研/</a>
    </li>
    <li class="post-copyright-license">
      <strong>Copyright notice:   </strong>
      All articles on this website, unless otherwise stated, adopt <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
      reprint policy. If reproduced, please indicate source!
    </li>
  </ul>
<div>
      
    </article>
    <!-- 上一篇文章和下一篇文章 -->
    
      <!-- 文章详情页的上一页和下一页 -->
<div class="post-nav">



  
  <div class="post-nav-prev post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="/medias/4.jpg" class="lazyload placeholder" data-srcset="/medias/4.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="">
    </div>
    <a href="/2024/12/16/%E6%97%A5%E8%AE%B0-2024-12/" class="post-nav-link">
      <div class="title">
        <i class="fas fa-angle-left"></i> Prev:
        <div class="title-text">日记-2024-12</div>
      </div>
      
      <!-- <div class="content">
        16 日
2023年9月公司1768 人， 研发 787 人。
今天公司由 1745 人。 研发 768 人 （新招了4
      </div> -->
    </a>
  </div>



  
  <div class="post-nav-next post-nav-item">
    <div class="post-nav-img" style="background-size: cover; 
      background-position: center center;">
      <img class="lazyload lazyload placeholder" src="/medias/1.jpg" class="lazyload placeholder" data-srcset="/medias/1.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" src="" alt="">
    </div>
    <a href="/2024/12/09/k8s-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3v1-31-%E5%AD%A6%E4%B9%A0/" class="post-nav-link">
      <div class="title">
        Next: <i class="fas fa-angle-right"></i>
        <div class="title-text">k8s-官方文档v1.31 学习</div>
      </div>
      <!-- <div class="content">
        入门快速安装
仅学习使用单节点， 使用 choco 安装。
1choco install kubernetes-cli

      </div> -->
    </a>
  </div>

</div>

    
    

    <!-- 打赏 -->
    

    <!-- 分享 -->
    
      <!-- https://github.com/overtrue/share.js -->
<!-- 文章详情页的分享 -->
<div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>

<script src="/js/shareJs/social-share.min.js"></script>
</script>

<style>
  .social-share {
    margin: 20px 0;
  }
</style>


    
    
    <!-- 评论 -->
    <!-- 评论 -->

  <div id="myComment">
    
      <div id="gitment-container"></div>

    
  </div>

<!-- comment script in themes\hexo-theme-bamboo\layout\_partial\scripts\index.ejs -->


  </div>

  <!-- 目录 -->
  <!-- 文章详情页右侧目录 -->

  <div class="toc-aside">
    <div class="toc-main">
      <div class="toc-aside-title">
        <i class="fas fa-list-ul" aria-hidden="true"></i><span>catalog</span>
        
          <div class="toc-open-close">catalog</div>
        
      </div>
      <div class="toc-content">
        <div class="toc"></div>
      </div>
    </div>
  </div>

  <!-- 手机端目录按钮 -->
  <div id="toc-mobile-btn">
    <i class="fas fa-list-ul" aria-hidden="true"></i>
  </div>


<script>
  function closeToc(init) {
    $(".toc-aside").css({'width': 0, 'padding': 0, 'transition': init ?  'noe' : 'width 0.3s' });
    $(".toc-content").css({'width': 0});
    $(".toc-aside-title span, .toc-aside-title i").css({'display': 'none'});
    $(".main-content").css({'width': '75%', 'margin': '10px auto'});
  };
  function openToc() {
    $(".main-content").css({'width': '65%', 'margin-right': '10px', 'margin-left': 'calc(35% - 350px)'});
    $(".toc-aside").css({'width': '300px', 'padding': '0 10px', 'transition': 'width 0.3s'});
    $(".toc-content").css({'width': '300px'});
    $(".toc-aside-title span, .toc-aside-title i").css({'display': 'inline-block'});
  }
  function openBtnClickFn () {
    let openOrCloseBtn = $('.toc-aside .toc-aside-title .toc-open-close');
    let open = eval('' || 'true');
    openOrCloseBtn.click(function() {
      if (open) {
        closeToc();
        open = false;
      } else {
        openToc();
        open = true;
      }
    });
  };
  openBtnClickFn();
  initCloseTocWidth(true);

  function initCloseTocWidth(init) {
    if (window.innerWidth >= 992) {
      let isClose = false;
      isClose && closeToc(init)
    }
  }

  document.addEventListener('pjax:complete', function () {
    $(".toc-aside").css({'transition': 'no'});
  })
  document.addEventListener('pjax:complete', function () {
    openBtnClickFn();
  })
  
</script>

  <!-- 图片放大 Wrap images with fancybox support -->
  <script src="/js/wrapImage.js"></script>
</div>

<!-- 文章详情页背景图 -->
<div id="appBgSwiper" style="position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: -2;"
	:style="{'background-color': bgColor ? bgColor : 'transparent'}">
	<transition-group tag="ul" :name="names">
		<li v-for='(image,index) in img' :key='index' v-show="index === mark" class="bg-swiper-box">
			<img :src="image" class="bg-swiper-img no-lazy">
		</li>
	</transition-group>
</div>
<script>
	var vm = new Vue({
		el: '#appBgSwiper',
		data: {
			names: '' || 'fade' || 'fade', // translate-fade fade
			mark: 0,
			img: [],
			bgColor: '',
			time: null
		},
		methods: {   //添加方法
			change(i, m) {
				if (i > m) {
					// this.names = 'fade';
				} else if (i < m) {
					// this.names = 'fade';
				} else {
					return;
				}
				this.mark = i;
			},
			prev() {
				// this.names = 'fade';
				this.mark--;
				if (this.mark === -1) {
					this.mark = 3;
					return
				}
			},
			next() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			autoPlay() {
				// this.names = 'fade';
				this.mark++;
				if (this.mark === this.img.length) {
					this.mark = 0;
					return
				}
			},
			play() {
				let bgImgDelay = '' || '180000'
				let delay = parseInt(bgImgDelay) || 180000;
				this.time = setInterval(this.autoPlay, delay);
			},
			enter() {
				clearInterval(this.time);
			},
			leave() {
				this.play();
			}
		},
		created() {
			this.play()
		},
		beforeDestroy() {
			clearInterval(this.time);
		},
		mounted() {
			let prop = '' || '';
			let isImg = prop.includes('.bmp') || prop.includes('.jpg') || prop.includes('.png') || prop.includes('.tif') || prop.includes('.gif') || prop.includes('.pcx') || prop.includes('.tga') || prop.includes('.exif') || prop.includes('.fpx') || prop.includes('.psd') || prop.includes('.cdr') || prop.includes('.pcd') || prop.includes('.dxf') || prop.includes('.ufo') || prop.includes('.eps') || prop.includes('.ai') || prop.includes('.raw') || prop.includes('.WMF') || prop.includes('.webp') || prop.includes('.jpeg') || prop.includes('http://') || prop.includes('https://')
			if (isImg) {
				let img = prop.split(',');
				let configRoot = '/'
				let arrImg = [];
				img.forEach(el => {
					var Expression = /http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/;
					var objExp = new RegExp(Expression);

					if (objExp.test(el)) {
						// http or https
						arrImg.push(el);
					} else {
						// 非http or https开头
						// 本地文件
						let firstStr = el.charAt(0);
						if (firstStr == '/') {
							el = el.substr(1); // 删除第一个字符 '/',因为 configRoot最后一个字符为 /
						}
						el = configRoot + el;
						arrImg.push(el);
					}
				})
				this.img = arrImg;
			} else {
				this.bgColor = prop;
			}
		}
	})
</script>

<style>
	.bg-swiper-box {
		position: absolute;
		display: block;
		width: 100%;
		height: 100%;
	}

	.bg-swiper-img {
		object-fit: cover;
		width: 100%;
		height: 100%;
	}
</style>




  <script>
  function loadMermaid() {
    if (document.getElementsByClassName('mermaid').length) {
      if (window.mermaidJsLoad) mermaid.init()
      else {
        loadScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
          window.mermaidJsLoad = true
          mermaid.initialize({
            theme: 'default',
          })
          if ('true') {
            mermaid.init();
          }
        })
      }
    }
  };
  document.addEventListener("DOMContentLoaded", function () {
    loadMermaid();
  })

  document.addEventListener('pjax:complete', function () {
    loadMermaid();
  })
  
</script>


      </main>
    </div>

    <!-- 页脚 -->
    
  
  <div class="footer bg-color">
    <div class="footer-main">
      
        
          <div class="link">
            
          </div>
        
      
        
          <div class="footer-copyright">
            <p>Copyright © 2019 - 2022hexo <a target="_blank" rel="noopener" href="https://github.com/yuang01">yuang01</a> | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/yuang01/theme">Bamboo</a> </p>

          </div>
        
      
        
          
            <!-- 不蒜子统计 -->
            <!-- 不蒜子统计 -->
<span id="busuanzi_container_site_pv">
      <i class="fas fa-eye" aria-hidden="true"></i>Total visits：<span id="busuanzi_value_site_pv"></span> times
</span>
<span class="post-meta-divider">|</span>
<span id="busuanzi_container_site_uv" style='display:none'>
      <i class="fas fa-users" aria-hidden="true"></i>Number of visitors：<span id="busuanzi_value_site_uv"></span> people
</span>

          
        
      
        
          <div class="footer-custom">
            
          </div>
        
      
    </div>
  </div>



    <!-- 渲染暗黑按钮 -->
    
      <div class="dark">
  <div class="dark-content">
    <i class="fas fa-moon" aria-hidden="true"></i>
    <!-- <span>关灯</span> -->
  </div>
  
</div>

<script>
  $(function() {
    let isDark = JSON.parse(localStorage.getItem('dark'))  || JSON.parse('false');
    if (isDark) {
      $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
    }
    $('.dark').click(function() {
      if ($(document.body).is('.darkModel')) {
        $(document.body).removeClass('darkModel');
        localStorage.setItem('dark', false);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-moon" aria-hidden="true"></i>
          </div>
          `
        );
      } else {
        $(document.body).addClass('darkModel');
        localStorage.setItem('dark', true);
        $(".dark-content").replaceWith(
          `
          <div class='dark-content'>
            <i class="fas fa-lightbulb" aria-hidden="true"></i>
          </div>
          `
        );
      }
    })
  })
</script>
    
    <!-- 渲染回到顶部按钮 -->
    
      <div class="goTop top-btn-color" pointer>
  <i class="fas fa-arrow-up" aria-hidden="true"></i>
</div>
<script src="/js/goTop.js"></script>

    
    <!-- 渲染左下角音乐播放器 -->
    
      <link rel="stylesheet" href="/js/aplayer/APlayer@1.10.1.min.css">
<style>
.aplayer .aplayer-lrc p {
  
  font-size: 12px;
  font-weight: 700;
  line-height: 16px !important;
}

.aplayer .aplayer-lrc p.aplayer-lrc-current {
  
  font-size: 15px;
  color: #42b983;
}


.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
  left: -66px !important;
}

.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
  left: 0px !important;
}


</style>
<meting-js  
  class=""
  server="tencent"
  type="playlist"
  id="8062553743"
  fixed='true'
  autoplay='false'
  theme='#42b983'
  loop='all'
  order='random'
  preload='auto'
  volume='0.7'
  list-folded='true'
>
</meting-js>

<!-- <style>
  #aplayer {
    position: fixed;
    left: 0;
    bottom: 300px;
  }
</style> -->
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    

    <!-- 图片放大 -->
    
      <script src="/js/fancybox/jquery.fancybox.min.js"></script>
    

    <!-- 百度解析 -->
    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <!-- 背景彩带 -->
    
      <script type="text/javascript" size="100" alpha='0.4' zIndex="-1" src="/js/ribbon.min.js"></script>
    

    <script src="/js/utils/index.js"></script>
    <script src="/js/app.js"></script>
    
    <!-- 文章目录所需js -->
<link href="/js/tocbot/tocbot.css" rel="stylesheet">
<script src="/js/tocbot/tocbot.min.js"></script>

<script>
  var headerEl = 'h2, h3, h4',  //headers 
    content = '.post-detail',//文章容器
    idArr = {};  //标题数组以确定是否增加索引id
  //add #id
  var option = {
    // Where to render the table of contents.
    tocSelector: '.toc',
    // Where to grab the headings to build the table of contents.
    contentSelector: content,
    // Which headings to grab inside of the contentSelector element.
    headingSelector: headerEl,
    scrollSmooth: true,
    scrollSmoothOffset: -80,
    headingsOffset: -($(window).height() * 0.4 - 45),
    positionFixedSelector: '.toc-main',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    activeLinkClass: 'is-active-link',
    // onClick: function (e) {},
  }
  if ($('.toc').length > 0) {

    $(content).children(headerEl).each(function () {
      //去除空格以及多余标点
      var headerId = $(this).text().replace(/[\s|\~|`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\_|\+|\=|\||\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\：|\，|\。]/g, '');

      headerId = headerId.toLowerCase();
      if (idArr[headerId]) {
        //id已经存在
        $(this).attr('id', headerId + '-' + idArr[headerId]);
        idArr[headerId]++;
      }
      else {
        //id未存在
        idArr[headerId] = 1;
        $(this).attr('id', headerId);
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
      tocbot.init(option);
      mobileTocClick();
    });

  }

  window.tocScrollFn = function () {
    return bamboo.throttle(function () {
      findHeadPosition();
    }, 100)()
  }
  window.addEventListener('scroll', tocScrollFn);

  const findHeadPosition = function (top) {
    if ($('.toc-list').length <= 0) {
      return false;
    }
    setTimeout(() => {  // or DOMContentLoaded 
      autoScrollToc();
    }, 0);
  }

  const autoScrollToc = function () {
    const $activeItem = document.querySelector('.is-active-link');
    const $cardToc = document.querySelector('.toc-content');
    const activePosition = $activeItem.getBoundingClientRect().top
    const sidebarScrollTop = $cardToc.scrollTop
    if (activePosition > (document.documentElement.clientHeight - 100)) {
      $cardToc.scrollTop = sidebarScrollTop + 150
    }
    if (activePosition < 100) {
      $cardToc.scrollTop = sidebarScrollTop - 150
    }
  }

  document.addEventListener('pjax:send', function () {
    if ($('.toc').length) {
      tocbot.destroy();
    }
  });

  document.addEventListener('pjax:complete', function () {
    if ($('.toc').length) {
      tocbot.init(option);
      mobileTocClick();
    }
  });
  
  // 手机端toc按钮点击出现目录
  const mobileTocClick = function () {
    const $cardTocLayout = document.getElementsByClassName('toc-aside')[0];
    const $cardToc = $cardTocLayout.getElementsByClassName('toc-content')[0];
    let right = '45px';
    if (window.innerWidth >= 551 && window.innerWidth <= 992) {
      right = '100px'
    }
    const mobileToc = {
      open: () => {
        $cardTocLayout.style.cssText = 'animation: toc-open .3s; opacity: 1; right: ' + right
      },

      close: () => {
        $cardTocLayout.style.animation = 'toc-close .2s'
        setTimeout(() => {
          $cardTocLayout.style.cssText = "opacity:''; animation: ''; right: ''"
        }, 100)
      }
    }
    document.getElementById('toc-mobile-btn').addEventListener('click', () => {
      if (window.getComputedStyle($cardTocLayout).getPropertyValue('opacity') === '0') mobileToc.open()
      else mobileToc.close()
    })

    $cardToc.addEventListener('click', (e) => {
      if (window.innerWidth < 992) { // 小于992px的时候
        mobileToc.close()
      }
    })
  }
</script>

<style>
  .is-position-fixed {
    position: sticky !important;
    top: 74px;
  }

  .toc-main ul {
    counter-reset: show-list;
  }

  .toc-main ul li::before {
    content: counter(item)".";
    display: block;
    position: absolute;
    left: 12px;
    top: 0;
  }
</style> 

<!-- 设置导航背景 -->
<script>
  let setHeaderClass = () => {
    const headerMenuTransparent = true;
    if (!headerMenuTransparent) { return; }
    const nav = $('#navHeader');
    const navTop = nav.outerHeight();
    const winTop = $(window).scrollTop();
    if(winTop > navTop) {
      nav.addClass('header-bg-color');
    }
    else {
      nav.removeClass('header-bg-color');
    }
  };

  let scrollCollect = () => {
    return bamboo.throttle(function (e) {
      setHeaderClass();
    }, 200)()
  }

  let initHeaderBg = () => {
    setHeaderClass();
  }

  setHeaderClass();
  window.addEventListener('scroll', scrollCollect);

  document.addEventListener('pjax:send', function () {
    window.removeEventListener('scroll', scrollCollect)
  })
  document.addEventListener('pjax:complete', function () {
    window.addEventListener('scroll', scrollCollect);
    setHeaderClass();
  })
</script> 

<!-- 渲染issues标签里的内容 -->
<script>
  function loadIssuesJS() {
    if ($(".post-detail").find(".issues-api").length == 0) {
      return;
    } 
    loadScript('/js/issues/index.js');
  };
  $(function () {
    loadIssuesJS();
  });
  document.addEventListener('pjax:complete', function () {
    if (typeof IssuesAPI == "undefined") {
      loadIssuesJS();
    }
  })
</script>

<!-- 输入框打字特效 -->
<!-- 输入框打字特效 -->

  <script src="/js/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;  // 打开随机颜色特效
    POWERMODE.shake = false;    // 关闭输入框抖动
    document.body.addEventListener('input', POWERMODE);//监听打字事件
  </script>


<!-- markdown代码一键复制功能 -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.css">
  <script src="https://cdn.jsdelivr.net/npm/v-plugs-ayu/lib/ayu.umd.min.js"></script>
  <script src="/js/clipboard/clipboard.min.js"></script>
  <div id="appCopy">
  </div>
  <script data-pjax>
    var vm = new Vue({
      el: '#appCopy',
      data: {
      },
      computed: {
      },
      mounted() {
        const that = this;
        var copy = 'copy';
        /* code */
        var initCopyCode = function () {
          var copyHtml = '';
          copyHtml += '<button class="btn-copy" data-clipboard-snippet="" style="position:absolute;top:0;right:0;z-index:1;">';
          copyHtml += '<i class="fas fa-copy"></i><span>' + copy + '</span>';
          copyHtml += '</button>';
          $(".post-detail pre").not('.gutter pre').wrap("<div class='codeBox' style='position:relative;width:100%;'></div>")
          $(".post-detail pre").not('.gutter pre').before(copyHtml);
          new ClipboardJS('.btn-copy', {
            target: function (trigger) {
              return trigger.nextElementSibling;
            }
          });
        }
        initCopyCode();
        $('.btn-copy').unbind('click').bind('click', function () {
          doSomething();
        })
        $(document).unbind('keypress').bind('keypress', function (e) {
          if (e.ctrlKey && e.keyCode == 67) {
            doSomething();
          }
        })

        function doSomething() {
          that.$notify({
            title: "成功",
            content: "代码已复制，请遵守相关授权协议。",
            type: 'success'
          })
        }
      },
      methods: {
      },
      created() { }
    })
  </script>
  

<!-- 图片懒加载 -->
<script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>


<!-- 卡片滚动动画 -->
   

<!-- 评论所需js -->

  
    <script type="text/javascript">
  var utteranceCommon = {};

  function check_utterance() {
    let isDark = JSON.parse(localStorage.getItem('dark')) || JSON.parse('false');
    if (isDark) {
      utteranceCommon.Theme = 'github-dark';
    } else {
      utteranceCommon.Theme = 'github-light';
    }

    return document.getElementById("gitment-container");
  }
  comment_el = '#gitment-container';
  load_utterance = function () {
    if ($(comment_el).length) {
      // 匿名函数，防止污染全局变量
      const HEAD = check_utterance();

      var utterances = document.createElement('script');
      utterances.type = 'text/javascript';
      utterances.async = true;
      utterances.setAttribute('issue-term', 'pathname')
      utterances.setAttribute('theme', utteranceCommon.Theme)
      utterances.setAttribute('repo', '')
      utterances.crossorigin = 'anonymous';
      utterances.src = 'https://utteranc.es/client.js';
      // content 是要插入评论的地方
      document.getElementById('gitment-container').appendChild(utterances);

    }
  }

  function dark_utterance() {
    const HEAD = check_utterance();
    if (!HEAD) return;
    const message = {
      type: 'set-theme',
      theme: utteranceCommon.Theme
    };
    const utteranceIframe = document.querySelector('iframe');
    utteranceIframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }

  $(document).ready(load_utterance);
  document.addEventListener('pjax:complete', function () {
    load_utterance();
  });

  $('.dark').click(function () {
    setTimeout(() => {
      dark_utterance();
    });
  })

</script>

<style>
  .utterances {
    max-width: inherit !important;
  }
</style>
  


<!-- 鼠标点击特效 -->
<!-- 爱心点击 -->

   
    <script src="/js/cursor/clicklove.js"></script> 
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" data-pjax></script>


    <!-- pjax -->
    

<!-- pjax -->


  <script src="/js/pjax@0.2.8/index.js"></script>
  
    <!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <div class="loading-circle"><div id="loader-circle"></div></div>
    <script>
      window.ShowLoading = function() {
        $(".loading-circle").css("display", "block");
      };
      window.HideLoading = function() {
        $(".loading-circle").css("display", "none");
      }
    </script>
  
	<script>
    document.addEventListener('pjax:complete', function () {
      window.HideLoading();
    })
    document.addEventListener('pjax:send', function () {
      window.ShowLoading();
    })
    document.addEventListener('pjax:error', function () {
      window.HideLoading();
    })
	</script>
</div>

  

  <script>
    var pjax = new Pjax({
      elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([no-pjax])',   // 拦截正常带链接的 a 标签
      selectors: ["#pjax-container","title"],                                   // 根据实际需要确认重载区域
      cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
      timeout: 5000
    });

    document.addEventListener('pjax:send', function (e) {

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');

    })
    
    document.addEventListener('pjax:complete', function () {
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
    });

    document.addEventListener('pjax:error', function (e) {
      window.location.href = e.triggerElement.href;
    })
    
    // 刷新不从顶部开始
    document.addEventListener("DOMContentLoaded", function () {
      history.scrollRestoration = 'auto';
    })
  </script>



  </body>
</html>